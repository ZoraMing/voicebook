# ğŸ™ï¸ VoiceBook - æ™ºèƒ½æœ‰å£°ä¹¦åˆ¶ä½œç³»ç»Ÿ

VoiceBook æ˜¯ä¸€ä¸ªé›†æˆäº† LLM æ™ºèƒ½è§£æåŠŸèƒ½çš„æœ‰å£°ä¹¦åˆ¶ä½œå¹³å°ã€‚å®ƒèƒ½å¤Ÿå°† PDF/EPUB/TXT/MD ç”µå­ä¹¦è½¬æ¢ä¸ºç»“æ„åŒ–çš„æ®µè½ï¼Œåˆ©ç”¨å¯æ›¿æ¢çš„ TTS å¼•æ“åˆæˆé«˜è´¨é‡è¯­éŸ³ï¼Œå¹¶æä¾›åœ¨çº¿æ’­æ”¾å’Œç®¡ç†åŠŸèƒ½ã€‚

## ğŸ åŸºæœ¬éœ€æ±‚

- [x] ç”¨æˆ·å¯¼å…¥pdfï¼Œepubï¼Œtxtï¼Œmdï¼Œæš‚æ—¶å¿½ç•¥å›¾è¡¨æ ¼ è§£æä¸ºä¸€æ®µä¸€æ®µçš„ç« èŠ‚ï¼Œæ¯ä¸ªç« èŠ‚åŒ…å«å¤šä¸ªæ®µè½ï¼Œå­˜åœ¨sqliteä¸­ï¼Œæ–¹ä¾¿åç»­è°ƒç”¨ä½¿ç”¨
- [x] å¾—åˆ°sqliteçš„åˆ†ç« èŠ‚åˆ†æ®µè½æ–‡æœ¬åï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºè¯­éŸ³æ–‡ä»¶ï¼Œæ¯ä¸ªæ®µè½å¯¹åº”ä¸€ä¸ªè¯­éŸ³æ–‡ä»¶ï¼Œåšå¥½æ ‡è®°ï¼Œå¹¶æŒ‰ç…§ç« èŠ‚åˆå¹¶æˆä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶ï¼Œå·²æœ‰ffmpegå¯ç”¨äºå¤„ç†
- [x] æ¯ä¸ªç« èŠ‚çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸­åŒ…å«åˆå¹¶çš„éŸ³é¢‘æ–‡ä»¶ï¼Œä»¥åŠæ¯ä¸ªæ®µè½å¯¹ç…§çš„lrcæ–‡ä»¶
- [x] æä¾›è¿™ä¸ªä¹¦ç±æ–‡ä»¶å¤¹çš„å‹ç¼©åŒ…ä¸‹è½½
- [x] å‰ç«¯ç•Œé¢ä½¿ç”¨nextjsï¼Œæä¾›ä¸Šä¼ ï¼Œç®¡ç†ï¼Œæ’­æ”¾ï¼Œä¸‹è½½çš„åŠŸèƒ½
- [x] å¯ä»¥ä»»æ„æ›¿æ¢éŸ³é¢‘ç”Ÿæˆå¼•æ“ï¼Œä½¿ç”¨ç»Ÿä¸€è¾“å…¥è¾“å…¥è¾“å‡ºæ ¼å¼ï¼Œå½“ä¸‹å…ˆä½¿ç”¨ç”¨edgettsï¼Œåç»­å¯èƒ½ä½¿ç”¨apiæ¥å…¥æˆ–è€…æœ¬åœ°æ¨¡å‹
- [x] ä½¿ç”¨å¤šè¿›ç¨‹å’Œå¼‚æ­¥ç­‰å¿«é€Ÿå¤„ç†éŸ³é¢‘æ–‡ä»¶
- [ ] é€‚é…æœ¬åœ°éŸ³é¢‘æ¨¡å‹ï¼Œå’Œè¿œç¨‹éŸ³é¢‘apiè°ƒç”¨å¯ä¾›é€‰æ‹©

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **ğŸ“š å¤šæ ¼å¼æ”¯æŒ**: å…¼å®¹ PDFã€EPUBã€TXT å’Œ Markdown æ ¼å¼ç”µå­ä¹¦ã€‚
- **ğŸ§  æ™ºèƒ½åˆ†ç« **: å¯é€‰é›†æˆ LLMï¼ˆå¦‚ Qwen3ï¼‰ï¼Œæ™ºèƒ½å»é™¤é¡µçœ‰é¡µè„šã€åˆå¹¶æ–­å¥ï¼ŒæŒ‰é€»è¾‘é‡æ–°åˆ†ç« ã€‚
- **ğŸ—£ï¸ å¯æ›¿æ¢ TTS å¼•æ“**: é‡‡ç”¨ Provider æ¨¡å¼ï¼Œé»˜è®¤ä½¿ç”¨ Edge TTSï¼Œå¯æ‰©å±•ä¸º API æ¥å…¥æˆ–æœ¬åœ°æ¨¡å‹ï¼ˆåç»­æ›´æ–°ï¼‰ã€‚
- **ğŸ“ ç²¾ç¡®åŒæ­¥**: ç”Ÿæˆæ®µè½çº§ LRC æ­Œè¯æ–‡ä»¶ï¼Œæ”¯æŒæ–‡æœ¬ä¸éŸ³é¢‘çš„å®æ—¶åŒæ­¥ã€‚
- **ğŸš€ å¼‚æ­¥å¹¶å‘**: åç«¯é‡‡ç”¨å¼‚æ­¥æ¶æ„ + ä¿¡å·é‡å¹¶å‘æ§åˆ¶ï¼Œå¤§å¹…æå‡éŸ³é¢‘åˆæˆé€Ÿåº¦ã€‚
- **ğŸ“¦ å¯¼å‡ºä¸åˆ†äº«**: æ”¯æŒæŒ‰ç« èŠ‚åˆå¹¶ä¸º WAV éŸ³é¢‘ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆ LRC æ–‡ä»¶ï¼Œæä¾› ZIP å‹ç¼©åŒ…ä¸‹è½½ã€‚
- **ğŸŒ ç°ä»£åŒ–æ¶æ„**: FastAPI åç«¯ + Next.js å‰ç«¯ï¼Œå‰åç«¯åˆ†ç¦»è®¾è®¡ã€‚
- **ğŸ¶ éŸ³ä¹è½¯ä»¶å¯¼å…¥**ï¼šç”Ÿæˆå¯¹åº”æ–‡ä»¶å¤¹ï¼Œå¯ç›´æ¥å¯¼å…¥åˆ°ç½‘æ˜“äº‘éŸ³ä¹ç­‰è½¯ä»¶ä¸­ï¼Œæ¯é¦–æ­Œå°±æ˜¯å•ä¸ªæ–‡ä»¶å¤¹çš„éŸ³é¢‘+å¯¹åº”lrcæ–‡ä»¶

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

ç³»ç»Ÿé‡‡ç”¨å¾®æœåŠ¡é£æ ¼çš„åˆ†å±‚æ¶æ„ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ¨¡å—ï¼š

```mermaid
graph TD
    User[ç”¨æˆ·] --> |ä¸Šä¼ /æ’­æ”¾| WebUI[Next.js å‰ç«¯]
    WebUI --> |API è¯·æ±‚| API[FastAPI åç«¯]
    
    subgraph "Backend Services"
        API --> Router[è·¯ç”±å±‚]
        Router --> Decoder[è§£ææœåŠ¡]
        Router --> TTSSvc[TTS æœåŠ¡]
        Router --> ExportSvc[å¯¼å‡ºæœåŠ¡]
        
        Decoder --> |åŸå§‹æ–‡æœ¬| LLM[LLM æœåŠ¡ (Qwen3)]
        LLM --> |æ¸…æ´—ä¸åˆ†ç« | Decoder
        
        TTSSvc --> |æ–‡æœ¬| EdgeTTS[Edge TTS å¼•æ“]
        EdgeTTS --> |éŸ³é¢‘æµ| FileManager[æ®µè½éŸ³é¢‘ç®¡ç†]
        
        ExportSvc --> |åˆå¹¶éŸ³é¢‘| AudioMerger[éŸ³é¢‘åˆæˆ/LRCç”Ÿæˆ]
    end
    
    subgraph "Data Storage"
        Decoder --> |ä¹¦ç±/ç« èŠ‚æ•°æ®| DB[(SQLite æ•°æ®åº“)]
        TTSSvc --> |ä»»åŠ¡çŠ¶æ€| DB
        FileManager --> |MP3 ç‰‡æ®µ| AudioDir[audio/ ç›®å½•]
        AudioMerger --> |WAV+LRC| OutputDir[output/ ç›®å½•]
    end
```

## ğŸ”„ æ•°æ®å¤„ç†æµç¨‹

1.  **ä¸Šä¼  (Upload)**
    *   ç”¨æˆ·ä¸Šä¼  PDF/EPUB æ–‡ä»¶ã€‚
    *   åç«¯ä¿å­˜åŸå§‹æ–‡ä»¶åˆ° `ebook_input/`ã€‚

2.  **è§£æ (Decode)**
    *   **Legacy æ¨¡å¼**:
        *   PDF: æŒ‰é¡µæå–æ–‡æœ¬ã€‚
        *   EPUB: æå–é¢„å®šä¹‰çš„ç« èŠ‚ç»“æ„ã€‚
    *   **Smart æ¨¡å¼ (LLM)**:
        *   æå–å…¨ä¹¦æ–‡æœ¬å¹¶åˆ†å—å‘é€è‡³ LLM å¤„ç†å™¨ã€‚
        *   LLM è¯†åˆ«é€»è¾‘ç« èŠ‚æ ‡é¢˜ï¼Œè¿”å›ç»“æ„åŒ– JSONã€‚

3.  **å­˜å‚¨ (Storage)**
    *   å°†ä¹¦ç±ç»“æ„å­˜å…¥ SQLiteï¼ŒåŒ…å« Bookã€Chapterã€Paragraph ä¸‰çº§ã€‚

4.  **åˆæˆ (Synthesis)**
    *   å¹¶å‘è°ƒç”¨ Edge TTS ç”ŸæˆçŸ­éŸ³é¢‘ç‰‡æ®µã€‚
    *   å®æ—¶è®°å½•æ¯ä¸ªæ®µè½çš„å¼€å§‹/ç»“æŸæ—¶é—´ï¼Œç”¨äºç”Ÿæˆ LRCã€‚

5.  **å¯¼å‡º (Export)**
    *   æŒ‰ç« èŠ‚åˆå¹¶éŸ³é¢‘ç‰‡æ®µä¸ºé«˜è´¨é‡ WAVã€‚
    *   ç”Ÿæˆç²¾ç¡®å¯¹é½çš„ LRC æ–‡ä»¶ã€‚
    *   æ‰“åŒ…ä¸º ZIP ä¾›ä¸€é”®ä¸‹è½½ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯ (Backend)
*   **æ¡†æ¶**: FastAPI, Uvicorn
*   **æ•°æ®åº“**: SQLite, SQLAlchemy (Async)
*   **éŸ³é¢‘å¤„ç†**: FFmpeg (ç”¨äºåˆå¹¶ä¸è½¬æ¢)
*   **æ ¸å¿ƒåº“**: 
    *   `edge-tts`: è¯­éŸ³åˆæˆ
    *   `PyMuPDF`: PDF è§£æ
    *   `EbookLib` & `BeautifulSoup4`: EPUB è§£æ

### å‰ç«¯ (Frontend)
*   **æ¡†æ¶**: Next.js (React)
*   **é€šä¿¡**: Axios / SWR

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
*   Python 3.10+
*   Node.js 18+
*   FFmpeg (å¿…é¡»å®‰è£…å¹¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ï¼Œç”¨äºéŸ³é¢‘åˆå¹¶)

### 1. åç«¯å®‰è£…
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/Scripts/activate  # Windows: .venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```
### å¿«é€Ÿè®¿é—®
```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/Scripts/activate  # Windows: .venv\Scripts\activate
# è¿è¡Œåˆæˆ è¾“å…¥æ–‡ä»¶ å¹¶å‘æ•°
python run_full_synthesis.py "ebook_input/AIéƒ¨é—¨ç³»ç»Ÿåç«¯.pdf" 5

```


### 2. å¯åŠ¨æœåŠ¡
**åç«¯ API:**
```bash
python -m uvicorn app.main:app --reload
```
*API æ–‡æ¡£: http://localhost:8000/docs*

**å‰ç«¯ (å¦å¼€ç»ˆç«¯):**
```bash
cd frontend
npm install
npm run dev
```
*è®¿é—®åœ°å€: http://localhost:3000*

## ğŸ“ API æ¦‚è§ˆ

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|:-----|:-----|:-----|
| POST | `/api/books/upload` | ä¸Šä¼ å¹¶è§£æç”µå­ä¹¦ |
| GET | `/api/books` | è·å–ä¹¦ç±åˆ—è¡¨ |
| POST | `/api/tts/{id}/start` | å¯åŠ¨ TTS åˆæˆä»»åŠ¡ |
| POST | `/api/books/{id}/export` | è§¦å‘ WAV+LRC å¯¼å‡º |
| GET | `/api/books/{id}/export/download` | ä¸‹è½½å¯¼å‡ºçš„ ZIP åŒ… |
| GET | `/outputs/{path}` | è®¿é—®å¯¼å‡ºçš„æœ€ç»ˆéŸ³é¢‘/å­—å¹• |

