# ğŸ™ï¸ VoiceBook - æ™ºèƒ½æœ‰å£°ä¹¦åˆ¶ä½œç³»ç»Ÿ (v2.2.0)

VoiceBook æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æœ‰å£°ä¹¦åˆ¶ä½œå¹³å°ï¼Œé›†æˆäº†æ™ºèƒ½æ–‡æœ¬è§£æã€é«˜ç²¾åº¦è¯­éŸ³åˆæˆä¸å¯è§†åŒ–çš„ç¼–è¾‘ç®¡ç†åŠŸèƒ½ã€‚å®ƒèƒ½å¤Ÿå°†ç”µå­ä¹¦ï¼ˆPDF/EPUB/TXT/MDï¼‰è½¬æ¢ä¸ºç»“æ„åŒ–çš„éŸ³é¢‘å†…å®¹ï¼Œæ”¯æŒé€æ®µç²¾ç»†è°ƒæ•´ã€æ‰¹é‡åˆæˆå¯¼å‡ºï¼Œå¹¶æä¾›æè‡´çš„ Web Studio ç¼–è¾‘ä½“éªŒã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§ (v2.2 æ›´æ–°)

### ğŸ¨ ç°ä»£åŒ– Web Studio
- **æ²‰æµ¸å¼ç¼–è¾‘ä½“éªŒ**: åŸºäº **Next.js 16** å’Œ **Tailwind CSS v4** æ„å»ºçš„å…¨æ–°ç•Œé¢ï¼Œæ”¯æŒå¤œé—´æ¨¡å¼ä¸å“åº”å¼è®¾è®¡ã€‚
- **å®æ—¶é¢„è§ˆä¸ç¼–è¾‘**: æ‰€è§å³æ‰€å¾—çš„æ®µè½ç¼–è¾‘å™¨ï¼Œæ”¯æŒæ–‡æœ¬ä¿®æ”¹ã€è¯­éŸ³è§’è‰²åˆ‡æ¢ä¸å®æ—¶è¯•å¬ã€‚
- **æ™ºèƒ½è¿›åº¦è¿½è¸ª**: å…¨å±€è¿›åº¦æ¡å®æ—¶åé¦ˆåˆæˆçŠ¶æ€ï¼Œæ”¯æŒå¤šä»»åŠ¡å¹¶å‘å¤„ç†ã€‚

### âš¡ é«˜æ•ˆåˆæˆå·¥ä½œæµ
- **æ‰¹é‡åˆæˆå¼•æ“**: æ”¯æŒ**å…¨ä¹¦**ã€**å•ç« **æˆ–**å¤šé€‰æ®µè½**çš„ä¸€é”®æ‰¹é‡åˆæˆã€‚
- **é«˜ç²¾åº¦ TTS**: é›†æˆ Microsoft Edge TTSï¼Œæ”¯æŒ **WordBoundary** çº§æ—¶é—´æˆ³ï¼Œå®ç°æ¯«ç§’çº§éŸ³ç”»åŒæ­¥ã€‚
- **å¼‚æ­¥å¹¶å‘æ¶æ„**: åç«¯é‡‡ç”¨ FastAPI å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ”¯æŒå¤§è§„æ¨¡æ–‡æœ¬å¹¶å‘å¤„ç†ï¼Œç¨³å®šé«˜æ•ˆã€‚

### ğŸ“š æ™ºèƒ½å†…å®¹ç®¡ç†
- **å¤šæ ¼å¼è§£æ**: å®Œç¾æ”¯æŒ PDFã€EPUBã€TXT å’Œ Markdown æ ¼å¼ï¼Œè‡ªåŠ¨è¯†åˆ«ç›®å½•ç»“æ„ä¸ç« èŠ‚ã€‚
- **æ™ºèƒ½åˆ†ç« **: å†…ç½® LLM è¾…åŠ©è§£æï¼ˆå¯é€‰ï¼‰ï¼Œæ™ºèƒ½ä¼˜åŒ–æ–­å¥ä¸ç« èŠ‚åˆ’åˆ†ã€‚
- **é«˜å“è´¨å¯¼å‡º**: ä¸€é”®å¯¼å‡ºä¸ºæŒ‰ç« èŠ‚åˆå¹¶çš„ WAV éŸ³é¢‘ä¸ç²¾ç¡®æ—¶é—´æˆ³ LRC æ­Œè¯æ–‡ä»¶ï¼Œå®Œç¾é€‚é…ä¸»æµéŸ³ä¹æ’­æ”¾å™¨ã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TD
    User[ç”¨æˆ·] --> |Web äº¤äº’| WebUI
    
    subgraph "Frontend (Next.js 16)"
        WebUI[VoiceBook Studio]
        State[SWR çŠ¶æ€ç®¡ç†]
        Player[å…¨å±€éŸ³é¢‘æ’­æ”¾å™¨]
    end
    
    WebUI --> |REST API| API
    
    subgraph "Backend (FastAPI)"
        API[API ç½‘å…³]
        Worker[åå°ä»»åŠ¡é˜Ÿåˆ—]
        Parser[ç”µå­ä¹¦è§£æå™¨]
        TTS[TTS åˆæˆå¼•æ“]
        Export[éŸ³é¢‘å¯¼å‡ºæœåŠ¡]
    end
    
    subgraph "Storage"
        DB[(SQLite)]
        FS[æ–‡ä»¶ç³»ç»Ÿ (audio/output)]
    end
    
    API --> DB & FS
    Worker --> TTS
    TTS --> FS
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### å‰ç«¯ (Frontend)
- **Framework**: Next.js 16 (App Router)
- **Styling**: Tailwind CSS v4
- **State Management**: SWR (Stale-While-Revalidate)
- **Icons**: Lucide React
- **Testing**: Playwright (E2E)

### åç«¯ (Backend)
- **Framework**: FastAPI + SQLAlchemy
- **Language**: Python 3.12+ (æ”¯æŒ 3.13+)
- **Media Processing**: FFmpeg
- **TTS Engine**: Edge TTS (edge-tts)
- **Audio Logic**: Pydub (é’ˆå¯¹ Python 3.13 éœ€è¦ `audioop-lts`)

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²å®‰è£… Python 3.12+ å’Œ Node.js 20+ã€‚

```bash
python -m venv .venv
# æ¿€æ´» Python è™šæ‹Ÿç¯å¢ƒ
# Windows
.venv\Scripts\activate
# Linux/Mac
source .venv/bin/activate

# å®‰è£…åç«¯ä¾èµ–
pip install -r requirements.txt

# é’ˆå¯¹ Python 3.13+ ç”¨æˆ· (å¿…é¡»å®‰è£…å¦åˆ™æ— æ³•åˆå¹¶éŸ³é¢‘)
pip install audioop-lts
```

### 2. å¯åŠ¨åç«¯æœåŠ¡

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```
åç«¯æœåŠ¡å°†è¿è¡Œåœ¨ `http://localhost:8000`ï¼ŒAPI æ–‡æ¡£ä½äº `/docs`ã€‚

### 3. å¯åŠ¨å‰ç«¯ Studio

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd front

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```
è®¿é—® `http://localhost:3000` å³å¯è¿›å…¥ VoiceBook Studioã€‚

### 4. è‡ªåŠ¨åŒ–æµ‹è¯• (å¯é€‰)

é¡¹ç›®åŒ…å«å®Œæ•´çš„ç«¯åˆ°ç«¯ (E2E) æµ‹è¯•å¥—ä»¶ï¼Œç”¨äºéªŒè¯æ ¸å¿ƒåŠŸèƒ½ã€‚

```bash
cd front
npx playwright test
```

### 5. CLI å¿«é€Ÿå¯¼å‡ºå·¥å…· (New)

å¦‚æœä½ ä¸æƒ³å¯åŠ¨ Web ç•Œé¢æˆ–åç«¯æœåŠ¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ CLI å·¥å…·å¯¼å‡ºå·²åˆæˆçš„ä¹¦ç±ï¼š

```bash
# åˆ—å‡ºæ‰€æœ‰ä¹¦ç± ID å¹¶æ ¹æ®æç¤ºé€‰æ‹©å¯¼å‡º
python cli_export.py

# æˆ–è€…ç›´æ¥æŒ‡å®šä¹¦ç± ID å¯¼å‡º
python cli_export.py 1
```
*è¯¥å·¥å…·æä¾›å®æ—¶è¿›åº¦æ¡ï¼ˆtqdmï¼‰ï¼Œé€‚åˆå¤§æ‰¹é‡å¯¼å‡ºä»»åŠ¡ã€‚*


---

## ğŸ“ æ ¸å¿ƒ API

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|:-----|:-----|:-----|
| **GET** | `/api/books` | è·å–æ‰€æœ‰ä¹¦ç±åˆ—è¡¨ |
| **POST** | `/api/books/upload` | ä¸Šä¼ å¹¶è§£ææ–°ä¹¦ç± |
| **GET** | `/api/books/{id}/chapters` | è·å–ä¹¦ç±ç« èŠ‚ç»“æ„ |
| **GET** | `/api/books/chapters/{id}/paragraphs` | è·å–ç« èŠ‚ä¸‹çš„æ‰€æœ‰æ®µè½ |
| **POST** | `/api/books/{id}/synthesize-batch` | æ‰¹é‡åˆæˆæŒ‡å®šæ®µè½ |
| **POST** | `/api/books/{id}/chapters/{cid}/synthesize` | **[New]** åˆæˆæŒ‡å®šç« èŠ‚ |
| **POST** | `/api/books/{id}/synthesize` | **[New]** åˆæˆæ•´æœ¬ä¹¦ |
| **GET** | `/api/books/{id}/progress` | **[New]** è·å–å®æ—¶åˆæˆè¿›åº¦ |
| **POST** | `/api/books/{id}/export` | å¯¼å‡ºä¹¦ç±ä¸ºéŸ³é¢‘åŒ… |

## ğŸ“¦ å¯¼å‡ºè¯´æ˜

å¯¼å‡ºå®Œæˆåï¼Œæ–‡ä»¶å°†ä¿å­˜åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `output/` æ–‡ä»¶å¤¹ä¸‹ï¼Œç»“æ„å¦‚ä¸‹ï¼š

```text
output/
â””â”€â”€ ä¹¦ç±åç§°/
    â”œâ”€â”€ 01_ç¬¬ä¸€ç« .wav
    â”œâ”€â”€ 01_ç¬¬ä¸€ç« .lrc
    â”œâ”€â”€ 02_ç¬¬äºŒç« .wav
    â””â”€â”€ 02_ç¬¬äºŒç« .lrc
```

æ‚¨å¯ä»¥ç›´æ¥å°†æ–‡ä»¶å¤¹å¯¼å…¥ç½‘æ˜“äº‘éŸ³ä¹æˆ–å…¶ä»–æ”¯æŒæœ¬åœ°éŸ³ä¹çš„æ’­æ”¾å™¨ï¼Œäº«å—ç²¾ç¡®çš„æ­Œè¯åŒæ­¥ä½“éªŒã€‚

---

## â“ å¸¸è§é—®é¢˜

### 1. Python 3.13 æŠ¥é”™ `No module named 'audioop'`
è¿™æ˜¯ç”±äº Python 3.13 ç§»é™¤äº†å®˜æ–¹çš„ `audioop` æ¨¡å—ã€‚
**è§£å†³æ–¹æ³•**ï¼š
1. è¿è¡Œ `pip install audioop-lts`ã€‚
2. é¡¹ç›®å·²åœ¨ `cli_export.py` å’Œæ ¸å¿ƒä»£ç ä¸­é›†æˆäº†å…¼å®¹æ€§è¡¥ä¸ï¼Œå®‰è£…è¯¥åº“åå³å¯æ­£å¸¸è¿è¡Œã€‚

### 2. å¯¼å‡ºæ—¶æ˜¾ç¤ºâ€œéŸ³é¢‘åˆå¹¶å¤±è´¥â€
- ç¡®ä¿ç”µè„‘å·²å®‰è£… **FFmpeg** å¹¶å·²åŠ å…¥ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ˆPATHï¼‰ã€‚
- åœ¨ç»ˆç«¯è¾“å…¥ `ffmpeg -version` ç¡®è®¤å…¶å¯ç”¨æ€§ã€‚
- ç¡®ä¿ `.venv` ç¯å¢ƒä¸­å·²æ­£ç¡®å®‰è£… `pydub`ã€‚

### 3. Edge TTS åˆæˆè¶…æ—¶
- æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚
- å¦‚æœåœ¨å—é™ç½‘ç»œç¯å¢ƒï¼Œå¯ä»¥åœ¨ `app/config.py` ä¸­é…ç½® `TTS_PROXY`ã€‚

